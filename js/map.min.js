function loadJScript(){var a=document.createElement("script");a.type="text/javascript";a.src="http://api.map.baidu.com/api?v=2.0&ak=zEL98QMGfP7OGIV1Y7wGDWYL8w0YTqpC&callback=init";document.body.appendChild(a)}function init(){var f=new BMap.Map("right");var a=new BMap.Point(117.296819,31.903629);f.centerAndZoom(a,16);f.setCurrentCity("安徽合肥");f.enableScrollWheelZoom(true);var b=new BMap.Marker(a);f.addOverlay(b);b.setAnimation(BMAP_ANIMATION_BOUNCE);function g(){var j=f.getOverlays();for(var h=0;h<j.length;h++){f.removeOverlay(j[h])}}f.addEventListener("click",function(m){g();f.removeOverlay(f.getOverlays());var r=m.point.lng;var o=m.point.lat;var p=r+","+o;function q(v){var u=new BMap.Marker(v);u.enableDragging();f.addOverlay(u);u.setAnimation(BMAP_ANIMATION_BOUNCE)}var h=f.getBounds();var t=h.getSouthWest();var l=h.getNorthEast();var n=Math.abs(t.lng-l.lng);var k=Math.abs(l.lat-t.lat);var s=new BMap.Point(r,o);var j=$("#dropdown select option:selected").val();var i=new BMap.Circle(s,j,{fillColor:"skyblue",strokeWeight:1,fillOpacity:0.3,strokeOpacity:0.3});f.addOverlay(i);q(s);$.ajax({type:"GET",url:"http://api.map.baidu.com/geosearch/v3/nearby",dataType:"JSONP",data:{ak:"zEL98QMGfP7OGIV1Y7wGDWYL8w0YTqpC",geotable_id:"164951",location:p,radius:j,tags:"超市",sortby:"distance:1"},success:function(D,y,J){var v=[];var F=[];for(var C=0;C<D.contents.length;C++){var E={title:D.contents[C].title,distance:D.contents[C].distance,address:D.contents[C].address};v.push(E);var z=D.contents[C].location[0];var x=D.contents[C].location[1];var B=new BMap.Point(z,x);F.push(B);var K=new BMap.Icon("img/super.gif",new BMap.Size(25,70));var w=new BMap.Marker(B,{icon:K});f.addOverlay(w);var u={position:B,offset:new BMap.Size(-150,-70)};var G=new BMap.Label(D.contents[C].title+"     "+D.contents[C].address,u);$("div#right label").parent().css("width","350px");G.setStyle({color:"black",fontSize:"15px",width:"100%",height:"30px",border:"1px solid #aaa",background:"rgba(255,255,255,.6)",lineHeight:"25px",borderRadius:"8px"});f.addOverlay(G)}var H=[];for(var C=0;C<F.length;C++){H.push([F[C].lat,F[C].lng])}for(var C=0;C<H.length;C++){var I=new BMap.Point(H[C][1],H[C][0]);var A=new BMap.DrivingRoute(f,{renderOptions:{map:f,autoViewport:true},onPolylinesSet:function(L){searchRoute=L[0].getPolyline();f.addOverlay(searchRoute)},onMarkersSet:function(L){var M=new BMap.Marker(L[0].marker.getPosition(),{icon:K});f.removeOverlay(L[0].marker);var N=new BMap.Marker(L[1].marker.getPosition(),{icon:K});f.removeOverlay(L[1].marker);f.addOverlay(N)}});A.search(s,I)}v=JSON.stringify(v);localStorage.setItem("superMarket",v)}})});var d=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_LARGE,enableGeolocation:true});f.addControl(d);var e=new BMap.GeolocationControl();e.addEventListener("locationSuccess",function(i){var h="";h+=i.addressComponent.province;h+=i.addressComponent.city;h+=i.addressComponent.district;h+=i.addressComponent.street;h+=i.addressComponent.streetNumber;console.log("当前定位地址："+h)});e.addEventListener("locationError",function(h){alert(h.message)});f.addControl(e);f.enableInertialDragging();f.enableContinuousZoom();var c=new BMap.Size(10,20);f.addControl(new BMap.CityListControl({anchor:BMAP_ANCHOR_TOP_LEFT,offset:c}))}window.onload=loadJScript;